# Управление питанием с помощью реле
С помощью твердотельного реле можно управлять питанием принтера через веб-интерфейс Fluidd или Mainsail, кроме того питание принтера прекращается в случае любой критической ошибки клиппера (например, thermal runaway), что делает принтер более пожаробезопасным.

Реле рекомендую брать FOTEK, но можно взять и другое, от 10А и выше.

Схема подключения очень простая:

![image](https://github.com/Den2016/PWoff3Dprinter/assets/17118034/b2de6050-de40-4453-8d1f-dca4a7203298)

После подключения добавляем следующие строки в moonraker.conf

```
[power FBG5]
type: gpio
off_when_shutdown: True          # выключить принтер при обнаружении клиппером ошибки
locked_while_printing: False      # не выключать принтер во время печати
restart_klipper_when_powered: False    # выполнять команду "FIRMWARE_RESTART" после включения
restart_delay: 1            # задержка в секундах перед выполнением "FIRMWARE_RESTART"
pin: gpio26               # номер GPIO пина raspberry pi. при использовании нормально замкнутого реле можно инвертировать сигнгал так: !gpio26
initial_state: on            # исходное состояние при включении raspberry pi
```

В меню Fluidd появится пункт “Power”, где будет кнопка управления питанием принтера

![image](https://github.com/Den2016/PWoff3Dprinter/assets/17118034/579e8bbe-5381-425c-9388-f66812e94d64)

Проверить работоспособность защиты можно следующим образом:

1. Поворачиваем принтер на бок и снимаем крышку подвала
2. В файле printer.cfg в разделе [extruder] находим параметры max_temp и min_extrude_temp и меняем значение на любую низкую температуру, но выше комнатной
3. Устанавливаем температуру нагрева, которую мы указали в п.2. Когда показания термистора превысят порог хотя бы на 0.1 градус, клиппер выдаст ошибку “thermal runaway” и отключится
4. Альтернативно п.2-3 можно вытащить термистор и запустить нагрев хотенда, клиппер выдаст ошибку “Heater extruder not heating at expected rate” и отключится.
5. С помощью мультиметра замеряем напряжение на входе питания платы. Если напряжение отсутствует, значит защита сработала
